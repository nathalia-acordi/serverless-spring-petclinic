{
  "widgets": [
    {
      "type": "metric",
      "x": 0, "y": 0, "width": 12, "height": 6,
      "properties": {
        "region": "sa-east-1",
        "title": "Create - Latência (p50/p90/p99)",
        "view": "timeSeries",
        "stacked": false,
        "stat": "p50",
        "period": 60,
        "metrics": [
          [ "Petclinic", "OwnersCreateLatencyMs", "Operation", "Owners", "Endpoint", "POST_/owners", "Stage", "dev", { "stat": "p50" } ],
          [ "Petclinic", "OwnersCreateLatencyMs", "Operation", "Owners", "Endpoint", "POST_/owners", "Stage", "dev", { "stat": "p90" } ],
          [ "Petclinic", "OwnersCreateLatencyMs", "Operation", "Owners", "Endpoint", "POST_/owners", "Stage", "dev", { "stat": "p99" } ]
        ],
        "yAxis": { "left": { "label": "ms" } }
      }
    },
    {
      "type": "metric",
      "x": 12, "y": 0, "width": 12, "height": 6,
      "properties": {
        "region": "sa-east-1",
        "title": "Create - Contadores (sucesso x conflitos)",
        "view": "timeSeries",
        "stat": "Sum",
        "period": 60,
        "metrics": [
          [ "Petclinic", "OwnersCreatedCount", "Operation", "Owners", "Endpoint", "POST_/owners", "Stage", "dev" ],
          [ "Petclinic", "OwnersCreateConflictCount", "Operation", "Owners", "Endpoint", "POST_/owners", "Stage", "dev" ]
        ]
      }
    },
    {
      "type": "metric",
      "x": 0, "y": 6, "width": 12, "height": 6,
      "properties": {
        "region": "sa-east-1",
        "title": "Update - Latência (p50/p90/p99)",
        "view": "timeSeries",
        "period": 60,
        "metrics": [
          [ "Petclinic", "OwnersUpdateLatencyMs", "Operation", "Owners", "Endpoint", "PUT_/owners/{id}", "Stage", "dev", { "stat": "p50" } ],
          [ "Petclinic", "OwnersUpdateLatencyMs", "Operation", "Owners", "Endpoint", "PUT_/owners/{id}", "Stage", "dev", { "stat": "p90" } ],
          [ "Petclinic", "OwnersUpdateLatencyMs", "Operation", "Owners", "Endpoint", "PUT_/owners/{id}", "Stage", "dev", { "stat": "p99" } ]
        ]
      }
    },
    {
      "type": "metric",
      "x": 12, "y": 6, "width": 12, "height": 6,
      "properties": {
        "region": "sa-east-1",
        "title": "Update - Contadores (200/409/404/400/500)",
        "view": "timeSeries",
        "stat": "Sum",
        "period": 60,
        "metrics": [
          [ "Petclinic", "OwnersUpdateSuccessCount",     "Operation", "Owners", "Endpoint", "PUT_/owners/{id}", "Stage", "dev" ],
          [ "Petclinic", "OwnersUpdateConflictCount",    "Operation", "Owners", "Endpoint", "PUT_/owners/{id}", "Stage", "dev" ],
          [ "Petclinic", "OwnersUpdateNotFoundCount",    "Operation", "Owners", "Endpoint", "PUT_/owners/{id}", "Stage", "dev" ],
          [ "Petclinic", "OwnersUpdateBadRequestCount",  "Operation", "Owners", "Endpoint", "PUT_/owners/{id}", "Stage", "dev" ],
          [ "Petclinic", "OwnersUpdateErrorCount",       "Operation", "Owners", "Endpoint", "PUT_/owners/{id}", "Stage", "dev" ]
        ]
      }
    },
    {
      "type": "metric",
      "x": 0, "y": 12, "width": 12, "height": 6,
      "properties": {
        "region": "sa-east-1",
        "title": "GETs - Latência (id e lista)",
        "view": "timeSeries",
        "period": 60,
        "metrics": [
          [ "Petclinic", "OwnersGetLatencyMs",  "Operation", "Owners", "Endpoint", "GET_/owners/{id}", "Stage", "dev", { "stat": "p90" } ],
          [ "Petclinic", "OwnersListLatencyMs", "Operation", "Owners", "Endpoint", "GET_/owners",     "Stage", "dev", { "stat": "p90" } ]
        ]
      }
    },
    {
      "type": "metric",
      "x": 12, "y": 12, "width": 12, "height": 6,
      "properties": {
        "region": "sa-east-1",
        "title": "DELETE - Latência e Contadores",
        "view": "timeSeries",
        "period": 60,
        "metrics": [
          [ "Petclinic", "OwnersDeleteLatencyMs",     "Operation", "Owners", "Endpoint", "DELETE_/owners/{id}", "Stage", "dev", { "stat": "p90" } ],
          [ "Petclinic", "OwnersDeleteSuccessCount",  "Operation", "Owners", "Endpoint", "DELETE_/owners/{id}", "Stage", "dev", { "stat": "Sum", "yAxis": "right" } ],
          [ "Petclinic", "OwnersDeleteNotFoundCount", "Operation", "Owners", "Endpoint", "DELETE_/owners/{id}", "Stage", "dev", { "stat": "Sum", "yAxis": "right" } ]
        ],
        "yAxis": { "left": { "label": "ms" }, "right": { "label": "count" } }
      }
    },
    {
      "type": "log",
      "x": 0, "y": 18, "width": 24, "height": 7,
      "properties": {
        "region": "sa-east-1",
        "title": "Logs (Create/Update últimos 60 min)",
        "query": "SOURCE '/aws/lambda/petclinic-serverless-dev-owners-create' '/aws/lambda/petclinic-serverless-dev-owners-update'\n| filter @message like /OwnersCreate|OwnersUpdate/\n| fields @timestamp, @logStream, @message\n| sort @timestamp desc\n| limit 50",
        "view": "table"
      }
    },
    {
      "type": "log",
      "x": 0, "y": 25, "width": 24, "height": 7,
      "properties": {
        "region": "sa-east-1",
        "title": "Init Duration Compare (Create/Update)",
        "query": "SOURCE '/aws/lambda/petclinic-serverless-dev-owners-create' '/aws/lambda/petclinic-serverless-dev-owners-update'\n| filter @message like /Init Duration/\n| parse @message /Init Duration: (?<initMs>[0-9.]+) ms/\n| stats avg(initMs) as avgInitMs, pct(initMs,50) as p50, pct(initMs,90) as p90, pct(initMs,99) as p99 by @logGroup\n| sort avgInitMs desc",
        "view": "table"
      }
    }
  ]
}
